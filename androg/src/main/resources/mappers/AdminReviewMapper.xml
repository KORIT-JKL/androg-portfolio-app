<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.korit.androg.androg.repository.admin.AdminReviewRepository">
	<resultMap type="com.korit.androg.androg.dto.admin.ReviewsRespDto" id="reviewMap">
		<id property="reviewId" column="review_id"/>
		<result property="name" column="name"/>
		<result property="productName" column="product_name"/>
		<result property="content" column="content"/>
		<result property="date" column="review_date"/>
	</resultMap>
	<resultMap type="com.korit.androg.androg.dto.admin.ReviewsReviewRespDto" id="reviewreviewMap">
		<id property="reviewId" column="review_id"/>
		<result property="name" column="name"/>
		<result property="productName" column="product_name"/>
		<result property="reviewContent" column="review_content" />
		<result property="content" column="content"/>
		<result property="date" column="review_date"/>
	</resultMap>
	<select id="getReviews" resultType="List" resultMap="reviewMap">
		select
			rt.review_id,
		    pt.product_name,
			ut.name,
		    rt.content,
		    rt.review_date
		FROM
			review_tb rt
		    left outer join order_detail_tb odt on(odt.order_detail_id = rt.order_detail_id)
            left outer join product_tb pt on (odt.product_id = pt.product_id)
            left outer join order_tb ot on (ot.order_id = odt.order_id)
            left outer join user_tb ut on(ut.user_id = ot.user_id)
		order by
			rt.review_date desc;
	</select>
	<delete id="delteReivews" parameterType="Integer">
		delete from review_tb
		where review_id = #{reviewsId};
	</delete>
	<select id="getReviewsYesReview" resultMap="reviewreviewMap">
		SELECT 
		    rt.review_id,
		    rt.content,
		    ut.name,
		    art.review_content,
		    pt.product_name,
		    rt.review_date
		FROM
			review_tb rt
		    left outer join adminreview_tb art on(art.review_id = rt.review_id)
		    left outer join order_detail_tb odt on(odt.order_detail_id = rt.order_detail_id)
		    left outer join order_tb ot on(ot.order_id = odt.order_id)
		    left outer join user_tb ut on (ut.user_id = ot.user_id)
		    left outer join product_tb pt on(pt.product_id = odt.product_id)
		where
			art.adminreview_id is not null
	</select>
	<select id="getReviewsNoReview" resultMap="reviewreviewMap">
		SELECT 
		    rt.review_id,
		    rt.content,
		    ut.name,
		    art.review_content,
		    pt.product_name,
		    rt.review_date
		FROM
			review_tb rt
		    left outer join adminreview_tb art on(art.review_id = rt.review_id)
		    left outer join order_detail_tb odt on(odt.order_detail_id = rt.order_detail_id)
		    left outer join order_tb ot on(ot.order_id = odt.order_id)
		    left outer join user_tb ut on (ut.user_id = ot.user_id)
		    left outer join product_tb pt on(pt.product_id = odt.product_id)
		where
			art.adminreview_id is null
	</select>
	<insert id="reviewReviewRegister">
		insert into adminreview_tb
		values ( 0 , #{reviewId},#{content});
	</insert>
	<insert id="reviewReviewModify">
		update adminreview_tb
		set review_content= #{content}
		where review_id = #{reviewId}
	</insert>
</mapper>